@model Core.Dtos.TransferDto
@{
    var userId = ViewBag.UserId as int? ?? 0;
    var newStatus = ViewBag.NewStatus as int? ?? 1;
    
    var headerClass = newStatus switch
    {
        1 => "bg-success",
        2 => "bg-primary",
        _ => "bg-warning"
    };
    var headerIcon = newStatus switch
    {
        1 => "fas fa-shipping-fast",
        2 => "fas fa-check-double",
        _ => "fas fa-info-circle"
    };
    var headerTitle = newStatus switch
    {
        1 => "Transfer Gönderimi",
        2 => "Transfer Teslim Alma",
        _ => "Transfer Durumu Güncelleme"
    };
    var alertMessage = newStatus switch
    {
        1 => "Gönderilecek miktarları girin ve onaylayın.",
        2 => "Bu işlem transferi \"Tamamlandı\" olarak işaretleyecektir.",
        _ => "Transfer durumu güncellenecektir."
    };
    var confirmText = newStatus switch
    {
        1 => "Aşağıdaki miktarları gönderdiğinizi onaylıyor musunuz?",
        2 => "Bu transferi teslim aldığınızı onaylıyor musunuz?",
        _ => "Bu işlemi gerçekleştirmek istediğinizden emin misiniz?"
    };
    var buttonText = newStatus switch
    {
        1 => "Gönderildi Yap",
        2 => "Teslim Aldım",
        _ => "Onayla"
    };
    var buttonIcon = newStatus switch
    {
        1 => "fas fa-shipping-fast",
        2 => "fas fa-check-double",
        _ => "fas fa-check"
    };
    var modalSize = newStatus == 1 ? "modal-lg" : "";
}

<!-- Status Update Modal -->
<div class="modal fade" id="statusModal" tabindex="-1" aria-labelledby="statusModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered @modalSize">
        <div class="modal-content">
            <div class="modal-header @headerClass text-white">
                <h5 class="modal-title" id="statusModalTitle">
                    <i class="@headerIcon me-2"></i>@headerTitle
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="statusTransferId" value="@Model.Id" />
                <input type="hidden" id="statusUserId" value="@userId" />
                <input type="hidden" id="statusNewValue" value="@newStatus" />
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    @alertMessage
                </div>
                
                <div class="card mb-3">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-3 text-muted">Transfer bilgileri:</h6>
                        <table class="table table-sm table-borderless mb-0">
                            <tr>
                                <th style="width: 130px;">Transfer Kodu:</th>
                                <td><code>@Model.Name</code></td>
                            </tr>
                            <tr>
                                <th>Talep Eden:</th>
                                <td>@Model.FromShopName <small class="text-muted">(@Model.FromBrandName)</small></td>
                            </tr>
                            <tr>
                                <th>Gönderen:</th>
                                <td>@Model.ToShopName <small class="text-muted">(@Model.ToBrandName)</small></td>
                            </tr>
                            <tr>
                                <th>Ürün Sayısı:</th>
                                <td><span class="badge bg-info">@Model.DetailCount ürün</span></td>
                            </tr>
                        </table>
                    </div>
                </div>

                @if (newStatus == 1 && Model.Details.Any())
                {
                    <div class="card">
                        <div class="card-header bg-light">
                            <strong><i class="fas fa-boxes me-2"></i>Gönderilecek Miktarlar</strong>
                        </div>
                        <div class="card-body p-0">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Model</th>
                                        <th>Renk</th>
                                        <th>Beden</th>
                                        <th class="text-center">İstenen</th>
                                        <th class="text-center" style="width: 140px;">Gönderilecek</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var detail in Model.Details)
                                    {
                                        <tr>
                                            <td>@detail.ProductModel</td>
                                            <td><span class="color-badge">@detail.ProductColor</span></td>
                                            <td>@detail.ProductSize</td>
                                            <td class="text-center">
                                                <span class="badge bg-primary">@detail.QuantityReq</span>
                                            </td>
                                            <td class="text-center">
                                                <input type="number" class="form-control form-control-sm text-center status-qty-input"
                                                       data-detail-id="@detail.Id"
                                                       min="0" max="@detail.QuantityReq"
                                                       value="@detail.QuantityReq"
                                                       style="width: 80px; margin: 0 auto;" />
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }

                <p class="mt-3 mb-0 text-center">
                    <strong>@confirmText</strong>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Vazgeç</button>
                <button type="button" class="btn @headerClass text-white" onclick="confirmStatusUpdate()">
                    <i class="@buttonIcon me-2"></i>@buttonText
                </button>
            </div>
        </div>
    </div>
</div>
